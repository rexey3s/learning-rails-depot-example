<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
  <title>Depot</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<!-- Task C2: Adding a Page Layout 
	 myTask : Adding bootstrap-sass
-->
<body class='<%= controller.controller_name %>'>
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    	 <div class="navbar-header">
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    	 <a class="navbar-brand" href="#">
    	 <%= image_tag("logo.png") %></a>
    	 </div>
       <div class="collapse navbar-collapse"> 
    	 <ul class="nav navbar-nav">
        <li class="active"><%= link_to "Browse Products", store_url %></li>
        <li><%= link_to "Price List" %></li>
        <li><%= link_to "Contact Us" %></li>
        <li><%= link_to "Cart" %></li>
          </ul>
          <form class="navbar-form navbar-left">
          <button id="sidecart" class="btn btn-default">Side cart</button>

          </form>
       </div>
  </div>
</nav>
<% if @cart %>
<div id="wrapper" <%if @cart.line_items.empty? %>
class="toggled"
<% end  %>
>
<% else %>
<div id="wrapper">
<% end %>
        <!-- Sidebar -->
        <div class="container-fluid">
        <div id="sidebar-wrapper">
        <% if @cart %>
        <div id="cart"
        <% if @cart.line_items.empty? %>
        style="display: none"
        <% end %> >
        <%= render @cart %> 
        <% end %> 
        </div>
        </div>  
<div id="main-content" class="container-fluid">
<%= yield %>
</div>
</div>
</div>
</body>
 <script>
(function ($) {
    $("#sidecart").click(function(e) {
      e.preventDefault();

      if ($('#cart tr').length == 0) { 
        alert("Empty Cart"); 
      }
      else {
        $('#cart').css("display","");
        $("#wrapper").toggleClass("toggled");
      }
    });
    /**
     * Input Spinner
     */
    $('.spinner .btn:first-of-type').on('click', function(e) {
        var line_item = $(e.target).closest('tr').attr('data-line-item');
        var curQuantity = $('tr[data-line-item='+line_item+'] .spinner input').val();
     
        $.ajax({
          url: '/line_items/' + line_item + '/increment'  ,
          data : {
          },
          method : 'put',
          dataType: 'json',
          success: function(res) { 
                      $('tr[data-line-item='+line_item+'] .spinner input').val( parseInt($('tr[data-line-item='+line_item+'] .spinner input').val(), 10) + 1);
                      console.log(res);
                  },
          error: function(err) {
                      console.log(err);
                  }
        })
        
    });
    $('.spinner .btn:last-of-type').on('click', function(e) {
        var line_item = $(e.target).closest('tr').attr('data-line-item');
        var curVal = $('tr[data-line-item='+line_item+'] .spinner input').val();
        
        if(curVal > 1) {
          $('tr[data-line-item='+line_item+'] .spinner input').val( parseInt($('tr[data-line-item='+line_item+'] .spinner input').val(), 10) - 1);
        } else {
          $('tr[data-line-item='+line_item+']').find(':submit').click();
        }
    });
  })(jQuery);
 </script>
</html>
